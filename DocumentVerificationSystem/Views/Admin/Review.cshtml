@{
  Layout = "~/Views/Shared/_Layout.cshtml";
  var candidate = ViewBag.Candidate as DocumentVerificationSystem.Models.User;
  var documents = ViewBag.Documents as List<DocumentVerificationSystem.Models.Document>;
  var categories = ViewBag.Categories as List<DocumentVerificationSystem.Models.DocumentCategory>;
}

<h2>Review Documents for @candidate?.Email (@candidate?.RollNumber)</h2>

@if (TempData["Message"] != null)
{
  <div class="alert alert-success">@TempData["Message"]</div>
}

<form method="post" action="@Url.Action("Review","Admin")">
  <input type="hidden" name="candidateId" value="@candidate?.Id" />
  <table class="table">
    <thead>
      <tr>
        <th>Document Title</th>
        <th>Category</th>
        <th>View</th>
        <th>Status</th>
        <th>Comments</th>
      </tr>
    </thead>
    <tbody>
      @if (documents != null)
      {
        for (int i = 0; i < documents.Count; i++)
        {
          var doc = documents[i];
          var cat = categories?.FirstOrDefault(c => c.Id == doc.CategoryId);

          <tr>
            <td>@doc.Title</td>
            <td>@cat?.CategoryName</td>
            <td>
              <a href="@doc.FilePath" target="_blank">View</a>
            </td>
            <td>
              <input type="hidden" name="docIds" value="@doc.Id" />
              <select name="statuses" class="form-select">
                <option value="Pending" @(doc.Status == DocumentVerificationSystem.Models.DocumentStatus.Pending ? "selected" : "")>Pending</option>
                <option value="Verified" @(doc.Status == DocumentVerificationSystem.Models.DocumentStatus.Verified ? "selected" : "")>Verified</option>
                <option value="Rejected" @(doc.Status == DocumentVerificationSystem.Models.DocumentStatus.Rejected ? "selected" : "")>Rejected</option>
              </select>
            </td>
            <td>
              <textarea name="comments" class="form-control">@doc.AdminComments</textarea>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
  <button type="submit" class="btn btn-primary">Save</button>
</form>

<form method="post" action="@Url.Action("FinalizeSubmission","Admin")" class="mt-3">
  <input type="hidden" name="candidateId" value="@candidate?.Id" />
  <button type="submit" class="btn btn-success">Finalize Submission</button>
</form>
